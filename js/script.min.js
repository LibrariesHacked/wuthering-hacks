$(function(){-1!=window.location.pathname.indexOf("catalogue")&&$.when($.ajax(config.catalogueBranchesCsv),$.ajax(config.catalogueCategoriesCsv),$.ajax(config.catalogueGroupedCsv)).then(function(e,a,d){function c(e){return{all:function(){return e.all().filter(function(e){return e&&e.key&&1<=e.value})}}}var e=$.csv.toObjects(e[0]),a=$.csv.toObjects(a[0]),d=$.csv.toObjects(d[0]),f={},t=($.each(e,function(e,a){f[a.id]=a.branch}),{}),e=($.each(a,function(e,a){t[a.id]=a.category}),d.forEach(function(e){e.branch=toTitleCase(f[e.branch_id]),e.category=toTitleCase(t[e.category_id]),e.count=+e.count,e.issues=+e.issues,e.price=+e.price,e.published_year=e.published_year,e.renewals=+e.renewals,e.year_added=+e.year_added,e.day=+e.day_added}),crossfilter(d)),a=e.dimension(function(e){return e.year_added}),d=(c(a.group().reduceSum(function(e){return e.count})),a.group().reduceSum(function(e){return e.price}),c(a.group().reduceSum(function(e){return e.issues})),c(a.group().reduceSum(function(e){return e.renewals})),dc.numberDisplay("#cht-number-items")),a=e.groupAll().reduceSum(function(e){return e.count}),d=(d.valueAccessor(function(e){return e}).html({one:'<small>Items</small><br/><span class="big colour1">%number</span>',some:'<small>Items</small><br/><span class="big colour1">%number</span>',none:'<small>Items</small><br/><span class="big colour1">None</span>'}).group(a),dc.numberDisplay("#cht-number-issues")),a=e.groupAll().reduceSum(function(e){return e.issues}),d=(d.valueAccessor(function(e){return e}).html({one:'<small>Issues</small><br/><span class="big colour2">%number</span>',some:'<small>Issues</small><br/><span class="big colour2">%number</span>',none:'<small>Issues</small><br/><span class="big colour2">None</span>'}).group(a),dc.numberDisplay("#cht-number-renewals")),a=e.groupAll().reduceSum(function(e){return e.renewals}),d=(d.valueAccessor(function(e){return e}).html({one:'<small>Renewals</small><br/><span class="big colour3">%number</span>',some:'<small>Renewals</small><br/><span class="big colour3">%number</span>',none:'<small>Renewals</small><br/><span class="big colour3">None</span>'}).group(a),dc.numberDisplay("#cht-number-cost")),a=e.groupAll().reduceSum(function(e){return e.price});d.valueAccessor(function(e){return e}).html({one:'<small>Cost</small><br/><span class="big colour4">£%number</span>',some:'<small>Cost</small><br/><span class="big colour4">£%number</span>',none:'<small>Cost</small><br/><span class="big colour4">£0</span>'}).group(a);dc.dataCount(".dc-data-count").dimension(e).group(e.groupAll()).html({some:"<strong>%filter-count</strong> selected out of <strong>%total-count</strong> records | <a href='javascript:dc.filterAll(); dc.renderAll();'>Reset All</a><br/> &nbsp",all:"All records selected. Please click on the graphs to filter the data.<br/> &nbsp"});var r,n=dc.barChart("#cht-catalogue-year"),d=e.dimension(function(e){return+e.year_added}),a=d.group().reduceSum(function(e){return e.count}),o=(n.width($("div-catalogue-year").width()).height(250).margins({top:5,right:0,bottom:40,left:60}).group(a).dimension(d).elasticY(!0).elasticX(!0).xUnits(dc.units.ordinal).brushOn(!1).x(d3.scaleBand()).ordinalColors([config.colours[1]]).renderHorizontalGridLines(!0).xAxis().tickFormat(function(e){return e}),n.on("renderlet",function(e){e.selectAll("g.axis.x g.tick text").attr("transform","translate(-13, 20) rotate(270)")}),$("#reset-chart-year").on("click",function(e){return e.preventDefault(),n.filterAll(),dc.redrawAll(),!1}),dc.rowChart("#cht-catalogue-day")),a=e.dimension(function(e){return e.day}),d=a.group().reduceSum(function(e){return e.count}),s=(o.width($("div-catalogue-day").width()).height(250).label(function(e){return daysFull[e.key]}).margins({top:5,right:0,bottom:40,left:5}).group(d).dimension(a).ordering(function(e){return e}).ordinalColors([config.colours[1]]).elasticX(!0),o.on("renderlet",function(e){e.selectAll("g.axis g.tick text").attr("transform","translate(-10, 20) rotate(270)")}),$("#reset-chart-day").on("click",function(e){return e.preventDefault(),o.filterAll(),dc.redrawAll(),!1}),dc.barChart("#cht-catalogue-category")),d=e.dimension(function(e){return e.category}),a=(r=d.group().reduceSum(function(e){return e.count}),{all:function(){return r.all().filter(function(e){return"Other"!==e.key&&"Unknown"!==e.key})}}),i=(s.width($("div-catalogue-category").width()).height(250).margins({top:5,right:0,bottom:110,left:60}).group(a).dimension(d).elasticY(!0).elasticX(!0).xUnits(dc.units.ordinal).brushOn(!1).x(d3.scaleBand()).ordinalColors([config.colours[0]]).renderHorizontalGridLines(!0).yAxisLabel("Items").xAxis().tickFormat(function(e){return e}),s.on("renderlet",function(e){e.selectAll("g.axis.x g.tick text").attr("transform","translate(-13, 7) rotate(270)")}),$("#reset-chart-category").on("click",function(e){return e.preventDefault(),s.filterAll(),dc.redrawAll(),!1}),dc.barChart("#cht-catalogue-branch")),a=e.dimension(function(e){return e.branch}),d=a.group().reduceSum(function(e){return e.count}),b=(i.width($("div-catalogue-branch").width()).height(250).margins({top:5,right:0,bottom:125,left:60}).group(d).dimension(a).elasticY(!0).elasticX(!0).xUnits(dc.units.ordinal).brushOn(!1).x(d3.scaleBand()).ordinalColors([config.colours[0]]).renderHorizontalGridLines(!0).yAxisLabel("Items").xAxis().tickFormat(function(e){return e}),i.on("renderlet",function(e){e.selectAll("g.axis.x g.tick text").attr("transform","translate(-11, 10) rotate(270)")}),$("#reset-chart-branch").on("click",function(e){return e.preventDefault(),i.filterAll(),dc.redrawAll(),!1}),dc.renderAll(),$("#loader").hide(),$(window).width());$(window).on("resize",function(){$(window).width()!=b&&(b=$(window).width(),catalogueLineChart.width(document.getElementById("div-catalogue").offsetWidth),s.width(document.getElementById("div-catalogue-category").offsetWidth),o.width(document.getElementById("div-catalogue-day").offsetWidth),n.width(document.getElementById("div-catalogue-year").offsetWidth),i.width(document.getElementById("div-catalogue-branch").offsetWidth),dc.renderAll())})})});var colorbrewer={YlGn:{3:["#f7fcb9","#addd8e","#31a354"],4:["#ffffcc","#c2e699","#78c679","#238443"],5:["#ffffcc","#c2e699","#78c679","#31a354","#006837"],6:["#ffffcc","#d9f0a3","#addd8e","#78c679","#31a354","#006837"],7:["#ffffcc","#d9f0a3","#addd8e","#78c679","#41ab5d","#238443","#005a32"],8:["#ffffe5","#f7fcb9","#d9f0a3","#addd8e","#78c679","#41ab5d","#238443","#005a32"],9:["#ffffe5","#f7fcb9","#d9f0a3","#addd8e","#78c679","#41ab5d","#238443","#006837","#004529"]},YlGnBu:{3:["#edf8b1","#7fcdbb","#2c7fb8"],4:["#ffffcc","#a1dab4","#41b6c4","#225ea8"],5:["#ffffcc","#a1dab4","#41b6c4","#2c7fb8","#253494"],6:["#ffffcc","#c7e9b4","#7fcdbb","#41b6c4","#2c7fb8","#253494"],7:["#ffffcc","#c7e9b4","#7fcdbb","#41b6c4","#1d91c0","#225ea8","#0c2c84"],8:["#ffffd9","#edf8b1","#c7e9b4","#7fcdbb","#41b6c4","#1d91c0","#225ea8","#0c2c84"],9:["#ffffd9","#edf8b1","#c7e9b4","#7fcdbb","#41b6c4","#1d91c0","#225ea8","#253494","#081d58"]},GnBu:{3:["#e0f3db","#a8ddb5","#43a2ca"],4:["#f0f9e8","#bae4bc","#7bccc4","#2b8cbe"],5:["#f0f9e8","#bae4bc","#7bccc4","#43a2ca","#0868ac"],6:["#f0f9e8","#ccebc5","#a8ddb5","#7bccc4","#43a2ca","#0868ac"],7:["#f0f9e8","#ccebc5","#a8ddb5","#7bccc4","#4eb3d3","#2b8cbe","#08589e"],8:["#f7fcf0","#e0f3db","#ccebc5","#a8ddb5","#7bccc4","#4eb3d3","#2b8cbe","#08589e"],9:["#f7fcf0","#e0f3db","#ccebc5","#a8ddb5","#7bccc4","#4eb3d3","#2b8cbe","#0868ac","#084081"]},BuGn:{3:["#e5f5f9","#99d8c9","#2ca25f"],4:["#edf8fb","#b2e2e2","#66c2a4","#238b45"],5:["#edf8fb","#b2e2e2","#66c2a4","#2ca25f","#006d2c"],6:["#edf8fb","#ccece6","#99d8c9","#66c2a4","#2ca25f","#006d2c"],7:["#edf8fb","#ccece6","#99d8c9","#66c2a4","#41ae76","#238b45","#005824"],8:["#f7fcfd","#e5f5f9","#ccece6","#99d8c9","#66c2a4","#41ae76","#238b45","#005824"],9:["#f7fcfd","#e5f5f9","#ccece6","#99d8c9","#66c2a4","#41ae76","#238b45","#006d2c","#00441b"]},PuBuGn:{3:["#ece2f0","#a6bddb","#1c9099"],4:["#f6eff7","#bdc9e1","#67a9cf","#02818a"],5:["#f6eff7","#bdc9e1","#67a9cf","#1c9099","#016c59"],6:["#f6eff7","#d0d1e6","#a6bddb","#67a9cf","#1c9099","#016c59"],7:["#f6eff7","#d0d1e6","#a6bddb","#67a9cf","#3690c0","#02818a","#016450"],8:["#fff7fb","#ece2f0","#d0d1e6","#a6bddb","#67a9cf","#3690c0","#02818a","#016450"],9:["#fff7fb","#ece2f0","#d0d1e6","#a6bddb","#67a9cf","#3690c0","#02818a","#016c59","#014636"]},PuBu:{3:["#ece7f2","#a6bddb","#2b8cbe"],4:["#f1eef6","#bdc9e1","#74a9cf","#0570b0"],5:["#f1eef6","#bdc9e1","#74a9cf","#2b8cbe","#045a8d"],6:["#f1eef6","#d0d1e6","#a6bddb","#74a9cf","#2b8cbe","#045a8d"],7:["#f1eef6","#d0d1e6","#a6bddb","#74a9cf","#3690c0","#0570b0","#034e7b"],8:["#fff7fb","#ece7f2","#d0d1e6","#a6bddb","#74a9cf","#3690c0","#0570b0","#034e7b"],9:["#fff7fb","#ece7f2","#d0d1e6","#a6bddb","#74a9cf","#3690c0","#0570b0","#045a8d","#023858"]},BuPu:{3:["#e0ecf4","#9ebcda","#8856a7"],4:["#edf8fb","#b3cde3","#8c96c6","#88419d"],5:["#edf8fb","#b3cde3","#8c96c6","#8856a7","#810f7c"],6:["#edf8fb","#bfd3e6","#9ebcda","#8c96c6","#8856a7","#810f7c"],7:["#edf8fb","#bfd3e6","#9ebcda","#8c96c6","#8c6bb1","#88419d","#6e016b"],8:["#f7fcfd","#e0ecf4","#bfd3e6","#9ebcda","#8c96c6","#8c6bb1","#88419d","#6e016b"],9:["#f7fcfd","#e0ecf4","#bfd3e6","#9ebcda","#8c96c6","#8c6bb1","#88419d","#810f7c","#4d004b"]},RdPu:{3:["#fde0dd","#fa9fb5","#c51b8a"],4:["#feebe2","#fbb4b9","#f768a1","#ae017e"],5:["#feebe2","#fbb4b9","#f768a1","#c51b8a","#7a0177"],6:["#feebe2","#fcc5c0","#fa9fb5","#f768a1","#c51b8a","#7a0177"],7:["#feebe2","#fcc5c0","#fa9fb5","#f768a1","#dd3497","#ae017e","#7a0177"],8:["#fff7f3","#fde0dd","#fcc5c0","#fa9fb5","#f768a1","#dd3497","#ae017e","#7a0177"],9:["#fff7f3","#fde0dd","#fcc5c0","#fa9fb5","#f768a1","#dd3497","#ae017e","#7a0177","#49006a"]},PuRd:{3:["#e7e1ef","#c994c7","#dd1c77"],4:["#f1eef6","#d7b5d8","#df65b0","#ce1256"],5:["#f1eef6","#d7b5d8","#df65b0","#dd1c77","#980043"],6:["#f1eef6","#d4b9da","#c994c7","#df65b0","#dd1c77","#980043"],7:["#f1eef6","#d4b9da","#c994c7","#df65b0","#e7298a","#ce1256","#91003f"],8:["#f7f4f9","#e7e1ef","#d4b9da","#c994c7","#df65b0","#e7298a","#ce1256","#91003f"],9:["#f7f4f9","#e7e1ef","#d4b9da","#c994c7","#df65b0","#e7298a","#ce1256","#980043","#67001f"]},OrRd:{3:["#fee8c8","#fdbb84","#e34a33"],4:["#fef0d9","#fdcc8a","#fc8d59","#d7301f"],5:["#fef0d9","#fdcc8a","#fc8d59","#e34a33","#b30000"],6:["#fef0d9","#fdd49e","#fdbb84","#fc8d59","#e34a33","#b30000"],7:["#fef0d9","#fdd49e","#fdbb84","#fc8d59","#ef6548","#d7301f","#990000"],8:["#fff7ec","#fee8c8","#fdd49e","#fdbb84","#fc8d59","#ef6548","#d7301f","#990000"],9:["#fff7ec","#fee8c8","#fdd49e","#fdbb84","#fc8d59","#ef6548","#d7301f","#b30000","#7f0000"]},YlOrRd:{3:["#ffeda0","#feb24c","#f03b20"],4:["#ffffb2","#fecc5c","#fd8d3c","#e31a1c"],5:["#ffffb2","#fecc5c","#fd8d3c","#f03b20","#bd0026"],6:["#ffffb2","#fed976","#feb24c","#fd8d3c","#f03b20","#bd0026"],7:["#ffffb2","#fed976","#feb24c","#fd8d3c","#fc4e2a","#e31a1c","#b10026"],8:["#ffffcc","#ffeda0","#fed976","#feb24c","#fd8d3c","#fc4e2a","#e31a1c","#b10026"],9:["#ffffcc","#ffeda0","#fed976","#feb24c","#fd8d3c","#fc4e2a","#e31a1c","#bd0026","#800026"]},YlOrBr:{3:["#fff7bc","#fec44f","#d95f0e"],4:["#ffffd4","#fed98e","#fe9929","#cc4c02"],5:["#ffffd4","#fed98e","#fe9929","#d95f0e","#993404"],6:["#ffffd4","#fee391","#fec44f","#fe9929","#d95f0e","#993404"],7:["#ffffd4","#fee391","#fec44f","#fe9929","#ec7014","#cc4c02","#8c2d04"],8:["#ffffe5","#fff7bc","#fee391","#fec44f","#fe9929","#ec7014","#cc4c02","#8c2d04"],9:["#ffffe5","#fff7bc","#fee391","#fec44f","#fe9929","#ec7014","#cc4c02","#993404","#662506"]},Purples:{3:["#efedf5","#bcbddc","#756bb1"],4:["#f2f0f7","#cbc9e2","#9e9ac8","#6a51a3"],5:["#f2f0f7","#cbc9e2","#9e9ac8","#756bb1","#54278f"],6:["#f2f0f7","#dadaeb","#bcbddc","#9e9ac8","#756bb1","#54278f"],7:["#f2f0f7","#dadaeb","#bcbddc","#9e9ac8","#807dba","#6a51a3","#4a1486"],8:["#fcfbfd","#efedf5","#dadaeb","#bcbddc","#9e9ac8","#807dba","#6a51a3","#4a1486"],9:["#fcfbfd","#efedf5","#dadaeb","#bcbddc","#9e9ac8","#807dba","#6a51a3","#54278f","#3f007d"]},Blues:{3:["#deebf7","#9ecae1","#3182bd"],4:["#eff3ff","#bdd7e7","#6baed6","#2171b5"],5:["#eff3ff","#bdd7e7","#6baed6","#3182bd","#08519c"],6:["#eff3ff","#c6dbef","#9ecae1","#6baed6","#3182bd","#08519c"],7:["#eff3ff","#c6dbef","#9ecae1","#6baed6","#4292c6","#2171b5","#084594"],8:["#f7fbff","#deebf7","#c6dbef","#9ecae1","#6baed6","#4292c6","#2171b5","#084594"],9:["#f7fbff","#deebf7","#c6dbef","#9ecae1","#6baed6","#4292c6","#2171b5","#08519c","#08306b"]},Greens:{3:["#e5f5e0","#a1d99b","#31a354"],4:["#edf8e9","#bae4b3","#74c476","#238b45"],5:["#edf8e9","#bae4b3","#74c476","#31a354","#006d2c"],6:["#edf8e9","#c7e9c0","#a1d99b","#74c476","#31a354","#006d2c"],7:["#edf8e9","#c7e9c0","#a1d99b","#74c476","#41ab5d","#238b45","#005a32"],8:["#f7fcf5","#e5f5e0","#c7e9c0","#a1d99b","#74c476","#41ab5d","#238b45","#005a32"],9:["#f7fcf5","#e5f5e0","#c7e9c0","#a1d99b","#74c476","#41ab5d","#238b45","#006d2c","#00441b"]},Oranges:{3:["#fee6ce","#fdae6b","#e6550d"],4:["#feedde","#fdbe85","#fd8d3c","#d94701"],5:["#feedde","#fdbe85","#fd8d3c","#e6550d","#a63603"],6:["#feedde","#fdd0a2","#fdae6b","#fd8d3c","#e6550d","#a63603"],7:["#feedde","#fdd0a2","#fdae6b","#fd8d3c","#f16913","#d94801","#8c2d04"],8:["#fff5eb","#fee6ce","#fdd0a2","#fdae6b","#fd8d3c","#f16913","#d94801","#8c2d04"],9:["#fff5eb","#fee6ce","#fdd0a2","#fdae6b","#fd8d3c","#f16913","#d94801","#a63603","#7f2704"]},Reds:{3:["#fee0d2","#fc9272","#de2d26"],4:["#fee5d9","#fcae91","#fb6a4a","#cb181d"],5:["#fee5d9","#fcae91","#fb6a4a","#de2d26","#a50f15"],6:["#fee5d9","#fcbba1","#fc9272","#fb6a4a","#de2d26","#a50f15"],7:["#fee5d9","#fcbba1","#fc9272","#fb6a4a","#ef3b2c","#cb181d","#99000d"],8:["#fff5f0","#fee0d2","#fcbba1","#fc9272","#fb6a4a","#ef3b2c","#cb181d","#99000d"],9:["#fff5f0","#fee0d2","#fcbba1","#fc9272","#fb6a4a","#ef3b2c","#cb181d","#a50f15","#67000d"]},Greys:{3:["#f0f0f0","#bdbdbd","#636363"],4:["#f7f7f7","#cccccc","#969696","#525252"],5:["#f7f7f7","#cccccc","#969696","#636363","#252525"],6:["#f7f7f7","#d9d9d9","#bdbdbd","#969696","#636363","#252525"],7:["#f7f7f7","#d9d9d9","#bdbdbd","#969696","#737373","#525252","#252525"],8:["#ffffff","#f0f0f0","#d9d9d9","#bdbdbd","#969696","#737373","#525252","#252525"],9:["#ffffff","#f0f0f0","#d9d9d9","#bdbdbd","#969696","#737373","#525252","#252525","#000000"]},PuOr:{3:["#f1a340","#f7f7f7","#998ec3"],4:["#e66101","#fdb863","#b2abd2","#5e3c99"],5:["#e66101","#fdb863","#f7f7f7","#b2abd2","#5e3c99"],6:["#b35806","#f1a340","#fee0b6","#d8daeb","#998ec3","#542788"],7:["#b35806","#f1a340","#fee0b6","#f7f7f7","#d8daeb","#998ec3","#542788"],8:["#b35806","#e08214","#fdb863","#fee0b6","#d8daeb","#b2abd2","#8073ac","#542788"],9:["#b35806","#e08214","#fdb863","#fee0b6","#f7f7f7","#d8daeb","#b2abd2","#8073ac","#542788"],10:["#7f3b08","#b35806","#e08214","#fdb863","#fee0b6","#d8daeb","#b2abd2","#8073ac","#542788","#2d004b"],11:["#7f3b08","#b35806","#e08214","#fdb863","#fee0b6","#f7f7f7","#d8daeb","#b2abd2","#8073ac","#542788","#2d004b"]},BrBG:{3:["#d8b365","#f5f5f5","#5ab4ac"],4:["#a6611a","#dfc27d","#80cdc1","#018571"],5:["#a6611a","#dfc27d","#f5f5f5","#80cdc1","#018571"],6:["#8c510a","#d8b365","#f6e8c3","#c7eae5","#5ab4ac","#01665e"],7:["#8c510a","#d8b365","#f6e8c3","#f5f5f5","#c7eae5","#5ab4ac","#01665e"],8:["#8c510a","#bf812d","#dfc27d","#f6e8c3","#c7eae5","#80cdc1","#35978f","#01665e"],9:["#8c510a","#bf812d","#dfc27d","#f6e8c3","#f5f5f5","#c7eae5","#80cdc1","#35978f","#01665e"],10:["#543005","#8c510a","#bf812d","#dfc27d","#f6e8c3","#c7eae5","#80cdc1","#35978f","#01665e","#003c30"],11:["#543005","#8c510a","#bf812d","#dfc27d","#f6e8c3","#f5f5f5","#c7eae5","#80cdc1","#35978f","#01665e","#003c30"]},PRGn:{3:["#af8dc3","#f7f7f7","#7fbf7b"],4:["#7b3294","#c2a5cf","#a6dba0","#008837"],5:["#7b3294","#c2a5cf","#f7f7f7","#a6dba0","#008837"],6:["#762a83","#af8dc3","#e7d4e8","#d9f0d3","#7fbf7b","#1b7837"],7:["#762a83","#af8dc3","#e7d4e8","#f7f7f7","#d9f0d3","#7fbf7b","#1b7837"],8:["#762a83","#9970ab","#c2a5cf","#e7d4e8","#d9f0d3","#a6dba0","#5aae61","#1b7837"],9:["#762a83","#9970ab","#c2a5cf","#e7d4e8","#f7f7f7","#d9f0d3","#a6dba0","#5aae61","#1b7837"],10:["#40004b","#762a83","#9970ab","#c2a5cf","#e7d4e8","#d9f0d3","#a6dba0","#5aae61","#1b7837","#00441b"],11:["#40004b","#762a83","#9970ab","#c2a5cf","#e7d4e8","#f7f7f7","#d9f0d3","#a6dba0","#5aae61","#1b7837","#00441b"]},PiYG:{3:["#e9a3c9","#f7f7f7","#a1d76a"],4:["#d01c8b","#f1b6da","#b8e186","#4dac26"],5:["#d01c8b","#f1b6da","#f7f7f7","#b8e186","#4dac26"],6:["#c51b7d","#e9a3c9","#fde0ef","#e6f5d0","#a1d76a","#4d9221"],7:["#c51b7d","#e9a3c9","#fde0ef","#f7f7f7","#e6f5d0","#a1d76a","#4d9221"],8:["#c51b7d","#de77ae","#f1b6da","#fde0ef","#e6f5d0","#b8e186","#7fbc41","#4d9221"],9:["#c51b7d","#de77ae","#f1b6da","#fde0ef","#f7f7f7","#e6f5d0","#b8e186","#7fbc41","#4d9221"],10:["#8e0152","#c51b7d","#de77ae","#f1b6da","#fde0ef","#e6f5d0","#b8e186","#7fbc41","#4d9221","#276419"],11:["#8e0152","#c51b7d","#de77ae","#f1b6da","#fde0ef","#f7f7f7","#e6f5d0","#b8e186","#7fbc41","#4d9221","#276419"]},RdBu:{3:["#ef8a62","#f7f7f7","#67a9cf"],4:["#ca0020","#f4a582","#92c5de","#0571b0"],5:["#ca0020","#f4a582","#f7f7f7","#92c5de","#0571b0"],6:["#b2182b","#ef8a62","#fddbc7","#d1e5f0","#67a9cf","#2166ac"],7:["#b2182b","#ef8a62","#fddbc7","#f7f7f7","#d1e5f0","#67a9cf","#2166ac"],8:["#b2182b","#d6604d","#f4a582","#fddbc7","#d1e5f0","#92c5de","#4393c3","#2166ac"],9:["#b2182b","#d6604d","#f4a582","#fddbc7","#f7f7f7","#d1e5f0","#92c5de","#4393c3","#2166ac"],10:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#d1e5f0","#92c5de","#4393c3","#2166ac","#053061"],11:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#f7f7f7","#d1e5f0","#92c5de","#4393c3","#2166ac","#053061"]},RdGy:{3:["#ef8a62","#ffffff","#999999"],4:["#ca0020","#f4a582","#bababa","#404040"],5:["#ca0020","#f4a582","#ffffff","#bababa","#404040"],6:["#b2182b","#ef8a62","#fddbc7","#e0e0e0","#999999","#4d4d4d"],7:["#b2182b","#ef8a62","#fddbc7","#ffffff","#e0e0e0","#999999","#4d4d4d"],8:["#b2182b","#d6604d","#f4a582","#fddbc7","#e0e0e0","#bababa","#878787","#4d4d4d"],9:["#b2182b","#d6604d","#f4a582","#fddbc7","#ffffff","#e0e0e0","#bababa","#878787","#4d4d4d"],10:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#e0e0e0","#bababa","#878787","#4d4d4d","#1a1a1a"],11:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#ffffff","#e0e0e0","#bababa","#878787","#4d4d4d","#1a1a1a"]},RdYlBu:{3:["#fc8d59","#ffffbf","#91bfdb"],4:["#d7191c","#fdae61","#abd9e9","#2c7bb6"],5:["#d7191c","#fdae61","#ffffbf","#abd9e9","#2c7bb6"],6:["#d73027","#fc8d59","#fee090","#e0f3f8","#91bfdb","#4575b4"],7:["#d73027","#fc8d59","#fee090","#ffffbf","#e0f3f8","#91bfdb","#4575b4"],8:["#d73027","#f46d43","#fdae61","#fee090","#e0f3f8","#abd9e9","#74add1","#4575b4"],9:["#d73027","#f46d43","#fdae61","#fee090","#ffffbf","#e0f3f8","#abd9e9","#74add1","#4575b4"],10:["#a50026","#d73027","#f46d43","#fdae61","#fee090","#e0f3f8","#abd9e9","#74add1","#4575b4","#313695"],11:["#a50026","#d73027","#f46d43","#fdae61","#fee090","#ffffbf","#e0f3f8","#abd9e9","#74add1","#4575b4","#313695"]},Spectral:{3:["#fc8d59","#ffffbf","#99d594"],4:["#d7191c","#fdae61","#abdda4","#2b83ba"],5:["#d7191c","#fdae61","#ffffbf","#abdda4","#2b83ba"],6:["#d53e4f","#fc8d59","#fee08b","#e6f598","#99d594","#3288bd"],7:["#d53e4f","#fc8d59","#fee08b","#ffffbf","#e6f598","#99d594","#3288bd"],8:["#d53e4f","#f46d43","#fdae61","#fee08b","#e6f598","#abdda4","#66c2a5","#3288bd"],9:["#d53e4f","#f46d43","#fdae61","#fee08b","#ffffbf","#e6f598","#abdda4","#66c2a5","#3288bd"],10:["#9e0142","#d53e4f","#f46d43","#fdae61","#fee08b","#e6f598","#abdda4","#66c2a5","#3288bd","#5e4fa2"],11:["#9e0142","#d53e4f","#f46d43","#fdae61","#fee08b","#ffffbf","#e6f598","#abdda4","#66c2a5","#3288bd","#5e4fa2"]},RdYlGn:{3:["#fc8d59","#ffffbf","#91cf60"],4:["#d7191c","#fdae61","#a6d96a","#1a9641"],5:["#d7191c","#fdae61","#ffffbf","#a6d96a","#1a9641"],6:["#d73027","#fc8d59","#fee08b","#d9ef8b","#91cf60","#1a9850"],7:["#d73027","#fc8d59","#fee08b","#ffffbf","#d9ef8b","#91cf60","#1a9850"],8:["#d73027","#f46d43","#fdae61","#fee08b","#d9ef8b","#a6d96a","#66bd63","#1a9850"],9:["#d73027","#f46d43","#fdae61","#fee08b","#ffffbf","#d9ef8b","#a6d96a","#66bd63","#1a9850"],10:["#a50026","#d73027","#f46d43","#fdae61","#fee08b","#d9ef8b","#a6d96a","#66bd63","#1a9850","#006837"],11:["#a50026","#d73027","#f46d43","#fdae61","#fee08b","#ffffbf","#d9ef8b","#a6d96a","#66bd63","#1a9850","#006837"]},Accent:{3:["#7fc97f","#beaed4","#fdc086"],4:["#7fc97f","#beaed4","#fdc086","#ffff99"],5:["#7fc97f","#beaed4","#fdc086","#ffff99","#386cb0"],6:["#7fc97f","#beaed4","#fdc086","#ffff99","#386cb0","#f0027f"],7:["#7fc97f","#beaed4","#fdc086","#ffff99","#386cb0","#f0027f","#bf5b17"],8:["#7fc97f","#beaed4","#fdc086","#ffff99","#386cb0","#f0027f","#bf5b17","#666666"]},Dark2:{3:["#1b9e77","#d95f02","#7570b3"],4:["#1b9e77","#d95f02","#7570b3","#e7298a"],5:["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e"],6:["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e","#e6ab02"],7:["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e","#e6ab02","#a6761d"],8:["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e","#e6ab02","#a6761d","#666666"]},Paired:{3:["#a6cee3","#1f78b4","#b2df8a"],4:["#a6cee3","#1f78b4","#b2df8a","#33a02c"],5:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99"],6:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c"],7:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f"],8:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00"],9:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6"],10:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6","#6a3d9a"],11:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6","#6a3d9a","#ffff99"],12:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6","#6a3d9a","#ffff99","#b15928"]},Pastel1:{3:["#fbb4ae","#b3cde3","#ccebc5"],4:["#fbb4ae","#b3cde3","#ccebc5","#decbe4"],5:["#fbb4ae","#b3cde3","#ccebc5","#decbe4","#fed9a6"],6:["#fbb4ae","#b3cde3","#ccebc5","#decbe4","#fed9a6","#ffffcc"],7:["#fbb4ae","#b3cde3","#ccebc5","#decbe4","#fed9a6","#ffffcc","#e5d8bd"],8:["#fbb4ae","#b3cde3","#ccebc5","#decbe4","#fed9a6","#ffffcc","#e5d8bd","#fddaec"],9:["#fbb4ae","#b3cde3","#ccebc5","#decbe4","#fed9a6","#ffffcc","#e5d8bd","#fddaec","#f2f2f2"]},Pastel2:{3:["#b3e2cd","#fdcdac","#cbd5e8"],4:["#b3e2cd","#fdcdac","#cbd5e8","#f4cae4"],5:["#b3e2cd","#fdcdac","#cbd5e8","#f4cae4","#e6f5c9"],6:["#b3e2cd","#fdcdac","#cbd5e8","#f4cae4","#e6f5c9","#fff2ae"],7:["#b3e2cd","#fdcdac","#cbd5e8","#f4cae4","#e6f5c9","#fff2ae","#f1e2cc"],8:["#b3e2cd","#fdcdac","#cbd5e8","#f4cae4","#e6f5c9","#fff2ae","#f1e2cc","#cccccc"]},Set1:{3:["#e41a1c","#377eb8","#4daf4a"],4:["#e41a1c","#377eb8","#4daf4a","#984ea3"],5:["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00"],6:["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00","#ffff33"],7:["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00","#ffff33","#a65628"],8:["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00","#ffff33","#a65628","#f781bf"],9:["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00","#ffff33","#a65628","#f781bf","#999999"]},Set2:{3:["#66c2a5","#fc8d62","#8da0cb"],4:["#66c2a5","#fc8d62","#8da0cb","#e78ac3"],5:["#66c2a5","#fc8d62","#8da0cb","#e78ac3","#a6d854"],6:["#66c2a5","#fc8d62","#8da0cb","#e78ac3","#a6d854","#ffd92f"],7:["#66c2a5","#fc8d62","#8da0cb","#e78ac3","#a6d854","#ffd92f","#e5c494"],8:["#66c2a5","#fc8d62","#8da0cb","#e78ac3","#a6d854","#ffd92f","#e5c494","#b3b3b3"]},Set3:{3:["#8dd3c7","#ffffb3","#bebada"],4:["#8dd3c7","#ffffb3","#bebada","#fb8072"],5:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3"],6:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462"],7:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69"],8:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5"],9:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5","#d9d9d9"],10:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5","#d9d9d9","#bc80bd"],11:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5","#d9d9d9","#bc80bd","#ccebc5"],12:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5","#d9d9d9","#bc80bd","#ccebc5","#ffed6f"]}},daysFull=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],months=["Ja","Fe","Mr","Ap","My","Jn","Jl","Au","Se","Oc","Nv","De"],monthsFull=["January","February","March","April","May","June","July","August","September","October","November","December"],config={colours:["#36A2EB","#FF9F40","#FF6384","#4BC0C0","#9966FF"],librariescsv:"data/libraries.csv",librariesExtendedCsv:"data/newcastle_libraries_extended.csv",usagecsv:"data/dashboard_usage.csv",catalogueAuthorsCsv:"data/dashboard_catalogue_authors.csv",catalogueBranchesCsv:"data/dashboard_catalogue_branches.csv",catalogueCategoriesCsv:"data/dashboard_catalogue_categories.csv",catalogueClassificationsCsv:"data/dashboard_catalogue_classifications.csv",catalogueEditionsCsv:"data/dashboard_catalogue_editions.csv",catalogueGroupedCsv:"data/dashboard_catalogue_grouped.csv",catalogueLanguagesCsv:"data/dashboard_catalogue_languages.csv",cataloguePublishersCsv:"data/dashboard_catalogue_publishers.csv",membersCsv:"data/dashboard_newcastle_members.csv",postcodesGeoJson:"data/dashboard_postcode_districts.geojson",mapTiles:"//{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}.png",mapAttribution:'&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, &copy; <a href="http://cartodb.com/attributions">CartoDB</a>',mapToken:"pk.eyJ1IjoibGlicmFyaWVzaGFja2VkIiwiYSI6IlctaDdxSm8ifQ.bxf1OpyYLiriHsZN33TD2A"},toTitleCase=function(e){return e.replace(/\w\S*/g,function(e){return e.charAt(0).toUpperCase()+e.substr(1).toLowerCase()})};$(function(){var u,m,h,g,p,v,w;-1!=window.location.pathname.indexOf("members")&&(u=d3.timeParse("%d/%m/%y %H:%M:%S"),m=d3.timeParse("%d/%m/%Y %H:%M:%S"),h=d3.timeParse("%d/%m/%y"),g=d3.timeParse("%d/%m/%Y"),p=d3.timeFormat("%B %Y"),v=d3.timeFormat("%H"),w=d3.timeFormat("%B %Y"),$.when($.ajax(config.membersCsv),$.ajax(config.postcodesGeoJson)).then(function(e,a){var e=$.csv.toObjects(e[0]),e=(e.forEach(function(e){""===e["Date Added"]&&(e["Date Added"]=e["Last Used Date"]),e.dateadded=u(e["Date Added"]+" "+e["Time Added"]),null===e.dateadded&&(e.dateadded=m(e["Date Added"]+" "+e["Time Added"])),null===e.dateadded&&(e.dateadded=h(e["Date Added"])),null===e.dateadded&&(e.dateadded=g(e["Date Added"])),e.dateaddedmonth=w(p(e.dateadded)),e.yearAdded=e.dateadded.getFullYear(),e.monthAdded=e.dateadded.getMonth(),e.dayAdded=e.dateadded.getDay(),e.hourAdded=v(e.dateadded),e.library=toTitleCase(e["Library Registered At"]),e.postcodedistrict=e.Postcode,e.postcodearea=e.Postcode.replace(/\d/g,"")}),crossfilter(e)),d=(e.dimension(function(e){return e.dateaddedmonth}).group().reduceCount(function(e){return 1}),dc.numberDisplay("#cht-number-members")),c=e.groupAll().reduceCount(function(e){return 1}),d=(d.valueAccessor(function(e){return e}).html({one:'<small class="colour1">Members</small><br/><span class="big strong colour1">%number</span>',some:'<small class="colour1">Members</small><br/><span class="big strong colour1">%number</span>',none:'<small class="colour1">Members</small><br/><span class="big strong colour1">None</span>'}).group(c),dc.numberDisplay("#cht-number-branches")),f=e.dimension(function(e){return e.library}).group(),c=(d.valueAccessor(function(e){return e}).html({one:'<small class="colour2">Libraries</small><br/><span class="big strong colour2">%number</span>',some:'<small class="colour2">Libraries</small><br/><span class="big strong colour2">%number</span>',none:'<small class="colour2">Libraries</small><br/><span class="big strong colour2">None</span>'}),d.group({value:function(){return f.all().filter(function(e){return 0<e.value}).length}}),d.dimension(f),dc.numberDisplay("#cht-number-postcodedistricts")),t=e.dimension(function(e){return e.postcodedistrict}).group(),d=(c.valueAccessor(function(e){return e}).html({one:'<small class="colour3">Postcode districts</small><br/><span class="big strong colour3">%number</span>',some:'<small class="colour3">Postcode districts</small><br/><span class="big strong colour3">%number</span>',none:'<small class="colour3">Postcode districts</small><br/><span class="big strong colour3">None</span>'}),c.group({value:function(){return t.all().filter(function(e){return 0<e.value}).length}}),c.dimension(f),dc.numberDisplay("#cht-number-popularjoining")),r=e.dimension(function(e){return e.dayAdded}).group();d.valueAccessor(function(e){return e}).formatNumber(function(e){return daysFull[e]}).html({none:'<small class="colour4">Popular joining day</small><br/><span class="big strong colour4">%number</span>',one:'<small class="colour4">Popular joining day</small><br/><span class="big strong colour4">%number</span>',some:'<small class="colour4">Popular joining day</small><br/><span class="big strong colour4">%number</span>'}),d.group({value:function(){return r.all().filter(function(e){return 0<e.value}).sort(function(e,a){return a.value-e.value})[0].key}}),d.dimension(r);dc.dataCount(".dc-data-count").dimension(e).group(e.groupAll()).html({some:"<strong>%filter-count</strong> selected out of <strong>%total-count</strong> records | <a href='javascript:dc.filterAll(); dc.renderAll();'>Reset All</a><br/> &nbsp",all:"All records selected. Please click on the graphs to apply filters.<br/> &nbsp"});var n,c=e.dimension(function(e){return e.postcodedistrict}),d=c.group().reduceCount(function(e){return 1}),o=dc_leaflet.choroplethChart("#map").center([54.98,-1.61]).zoom(12).width($("#div-members-map").width()).brushOn(!0).geojson(a).renderPopup(!1).dimension(c).group(d).colors(colorbrewer.Blues[7]).colorDomain([d3.min(d.all(),dc.pluck("value")),d3.max(d.all(),dc.pluck("value"))]).colorAccessor(function(e,a){return e.value}).featureOptions(function(e){return{weight:1,color:"#e5e5e5",opacity:1,fillOpacity:.5,visible:!0}}).featureKeyAccessor(function(e){return e.properties.postdist}),s=(o.on("preRender",function(e){e.colorDomain(d3.extent(e.data(),e.valueAccessor()))}),o.on("preRedraw",function(e){e.colorDomain(d3.extent(e.data(),e.valueAccessor()))}),$("#reset-members-postcodedistrict").on("click",function(e){return e.preventDefault(),o.filterAll(),dc.redrawAll(),!1}),dc.barChart("#cht-members-branch")),a=e.dimension(function(e){return e.library}),c=a.group().reduceCount(function(e){return 1}),i=(s.width($("#div-members-branch").width()).height(250).margins({top:5,right:0,bottom:80,left:60}).group((n=c,{all:function(){return n.all().filter(function(e){return 0!==e.key.indexOf("Z")&&(e&&0!==e.value)})}})).ordinalColors([config.colours[1]]).dimension(a).elasticY(!0).elasticX(!0).x(d3.scaleBand()).xUnits(dc.units.ordinal).brushOn(!1).yAxisLabel("Members").renderHorizontalGridLines(!0).xAxis().tickFormat(function(e){return e}),$("#reset-members-branch").on("click",function(e){return e.preventDefault(),s.filterAll(),dc.redrawAll(),!1}),s.renderlet(function(e){e.selectAll("g.x text").attr("transform","translate(-13,10) rotate(270)"),e.selectAll(".column rect").each(function(e,a){var d=d3.select(this).attr("fill");d3.select(this).attr("style","stroke-width:1; stroke:"+d)})}),dc.barChart("#cht-members-hourjoined")),d=e.dimension(function(e){return e.hourAdded}),c=d.group().reduceCount(function(e){return 1}),b=(i.width($("#div-members-hourjoined").width()).height(200).margins({top:5,right:0,bottom:20,left:60}).group(c).ordinalColors([config.colours[2]]).dimension(d).elasticY(!0).elasticX(!0).x(d3.scaleBand()).xUnits(dc.units.ordinal).brushOn(!1).yAxisLabel("Members").renderHorizontalGridLines(!0).xAxis().tickFormat(function(e){return e}),$("#reset-members-hourjoined").on("click",function(e){return e.preventDefault(),i.filterAll(),dc.redrawAll(),!1}),dc.barChart("#cht-members-dayjoined")),a=e.dimension(function(e){return e.dayAdded}),c=a.group().reduceCount(function(e){return 1}),d=(b.width($("#div-members-dayjoined").width()).height(200).margins({top:5,right:0,bottom:20,left:60}).group(c).ordinalColors([config.colours[3]]).dimension(a).label(function(e){return e.y}).elasticY(!0).elasticX(!0).x(d3.scaleBand()).xUnits(dc.units.ordinal).brushOn(!1).yAxisLabel("Members").renderHorizontalGridLines(!0).xAxis().tickFormat(function(e){return daysFull[e]}),$("#reset-chart-dayjoined").on("click",function(e){return e.preventDefault(),b.filterAll(),dc.redrawAll(),!1}),b.yAxisPadding(20),$("#reset-members-dayjoined").on("click",function(e){return e.preventDefault(),b.filterAll(),dc.redrawAll(),!1}),dc.renderAll(),o.map().eachLayer(function(e){e instanceof L.TileLayer&&o.map().removeLayer(e)}),L.mapboxGL({accessToken:"none",style:"style.json"})),l=(o.map().addLayer(d),$("#loader").hide(),$(window).width());$(window).on("resize",function(){$(window).width()!=l&&(l=$(window).width(),membersLineChart.width($("#div-members-date").width()),o.width($("#div-members-map").width()),s.width($("#div-members-branch").width()),i.width($("#div-members-hourjoined").width()),b.width($("#div-members-dayjoined").width()),dc.renderAll())})}))}),$(function(){var F,e=window.location.pathname;"/index.html"!=e&&"/"!=e||(F=d3.timeParse("%Y-%m"),$.when($.ajax(config.usagecsv)).then(function(e){function a(e){return{all:function(){return e.all().filter(function(e){return e&&0!==e.value})}}}function d(e,a){return++e.count,e.total+=+a.sessions,e}function c(e,a){return--e.count,e.total-=+a.sessions,e}function f(){return{count:0,total:0}}var e=$.csv.toObjects(e),e=(e.forEach(function(e){e.date=F(e.month),e.visits=+e.visits,e.enquiries=+e.enquiries,e.issues=+e.issues,e.year=e.date.getFullYear(),e.month=e.date.getMonth(),e.sessions=+e.sessions.replace("%","")}),crossfilter(e)),t=e.dimension(function(e){return e.date}),r=a(t.group().reduceSum(function(e){return e.issues})),n=a(t.group().reduceSum(function(e){return e.enquiries})),o=a(t.group().reduceSum(function(e){return e.visits})),s=dc.numberDisplay("#cht-number-issues"),i=e.groupAll().reduceSum(function(e){return e.issues}),s=(s.valueAccessor(function(e){return e}).html({one:'<small>Issues</small><br/><span class="big strong colour1">%number</span>',some:'<small>Issues</small><br/><span class="big strong colour1">%number</span>',none:'<small>Issues</small><br/><span class="big strong colour1">None</span>'}).group(i),dc.numberDisplay("#cht-number-visits")),i=e.groupAll().reduceSum(function(e){return e.visits}),s=(s.valueAccessor(function(e){return e}).html({one:'<small>Visits</small><br/><span class="big strong colour2">%number</span>',some:'<small>Visits</small><br/><span class="big strong colour2">%number</span>',none:'<small>Visits</small><br/><span class="big strong colour2">None</span>'}).group(i),dc.numberDisplay("#cht-number-enquiries")),i=e.groupAll().reduceSum(function(e){return e.enquiries}),s=(s.valueAccessor(function(e){return e}).html({one:'<small>Enquiries</small><br/><span class="big strong colour3">%number</span>',some:'<small>Enquiries</small><br/><span class="big strong colour3">%number</span>',none:'<small>Enquiries</small><br/><span class="big strong colour3">None</span>'}).group(i),dc.numberDisplay("#cht-number-pc")),i=e.groupAll().reduce(d,c,f);s.valueAccessor(function(e){return(e.total/e.count).toFixed(1)}).html({one:'<small>PC utilisation</small><br/><span class="big strong colour4">%number%</span>',some:'<small>PC utilisation</small><br/><span class="big strong colour4">%number%</span>',none:'<small>PC utilisation</small><br/><span class="big strong colour4">None</span>'}).group(i);dc.dataCount(".dc-data-count").dimension(e).group(e.groupAll()).html({some:"<strong>%filter-count</strong> selected out of <strong>%total-count</strong> usage records | <a href='javascript:dc.filterAll(); dc.renderAll();'>Reset All</a><br/> &nbsp",all:"All records selected. Please click on the graphs to apply filters.<br/> &nbsp"});var s=e.dimension(function(e){return+e.year}),i=e.dimension(function(e){return e.month}),b=e.dimension(function(e){return e.Library}),l=dc.rowChart("#cht-issues-year"),u=s.group().reduceSum(function(e){return e.issues}),m=(l.width($("#div-issues-year").width()).height(280).margins({top:5,right:0,bottom:40,left:5}).group(u).ordinalColors([config.colours[0]]).dimension(s).ordering(function(e){return e}).elasticX(!0),$("#reset-chart-issues-year").on("click",function(e){return e.preventDefault(),l.filterAll(),dc.redrawAll(),!1}),l.on("renderlet",function(e){e.selectAll("g.axis g.tick text").attr("transform","translate(-10, 10) rotate(315)")}),dc.rowChart("#cht-issues-month")),u=i.group().reduceSum(function(e){return e.issues}),h=(m.width($("#div-issues-month").width()).height(280).label(function(e){return monthsFull[e.key]}).margins({top:5,right:0,bottom:40,left:5}).group(u).ordinalColors([config.colours[0]]).dimension(i).ordering(function(e){return e}).elasticX(!0),m.filterPrinter(function(e){return e.map(function(e){return monthsFull[e]}).join(", ")}),$("#reset-chart-issues-month").on("click",function(e){return e.preventDefault(),m.filterAll(),dc.redrawAll(),!1}),m.on("renderlet",function(e){e.selectAll("g.axis g.tick text").attr("transform","translate(-10, 10) rotate(315)")}),dc.barChart("#cht-issues-branch")),u=b.group().reduceSum(function(e){return e.issues}),g=(h.width($("#div-issues-branch").width()).height(280).margins({top:5,right:0,bottom:80,left:60}).group(u).ordinalColors([config.colours[0]]).dimension(b).elasticY(!0).elasticX(!0).xUnits(dc.units.ordinal).brushOn(!1).x(d3.scaleBand()).renderHorizontalGridLines(!0),$("#reset-chart-issues-branch").on("click",function(e){return e.preventDefault(),h.filterAll(),dc.redrawAll(),!1}),h.on("renderlet",function(e){e.selectAll("g.axis.x g.tick text").attr("transform","translate(-11, 40) rotate(270)")}),dc.rowChart("#cht-visits-year")),u=s.group().reduceSum(function(e){return e.visits}),p=(g.width($("#div-visits-year").width()).height(280).margins({top:5,right:0,bottom:40,left:5}).group(u).ordinalColors([config.colours[1]]).dimension(s).ordering(function(e){return e}).elasticX(!0),$("#reset-chart-visits-year").on("click",function(e){return e.preventDefault(),g.filterAll(),dc.redrawAll(),!1}),g.on("renderlet",function(e){e.selectAll("g.axis g.tick text").attr("transform","translate(-10, 10) rotate(315)")}),dc.rowChart("#cht-visits-month")),u=i.group().reduceSum(function(e){return e.visits}),v=(p.width($("#div-visits-month").width()).height(280).label(function(e){return monthsFull[e.key]}).margins({top:5,right:0,bottom:40,left:5}).group(u).ordinalColors([config.colours[1]]).dimension(i).ordering(function(e){return e}).elasticX(!0),p.filterPrinter(function(e){return e.map(function(e){return monthsFull[e]}).join(", ")}),$("#reset-chart-visits-month").on("click",function(e){return e.preventDefault(),p.filterAll(),dc.redrawAll(),!1}),p.on("renderlet",function(e){e.selectAll("g.axis g.tick text").attr("transform","translate(-10, 10) rotate(315)")}),dc.barChart("#cht-visits-branch")),u=b.group().reduceSum(function(e){return e.visits}),w=(v.width($("#div-visits-branch").width()).height(280).margins({top:5,right:0,bottom:80,left:60}).group(u).ordinalColors([config.colours[1]]).dimension(b).elasticY(!0).elasticX(!0).xUnits(dc.units.ordinal).brushOn(!1).x(d3.scaleBand()).renderHorizontalGridLines(!0),$("#reset-chart-visits-branch").on("click",function(e){return e.preventDefault(),v.filterAll(),dc.redrawAll(),!1}),v.on("renderlet",function(e){e.selectAll("g.x text").attr("transform","translate(-13, 40) rotate(270)")}),dc.rowChart("#cht-enquiries-year")),u=s.group().reduceSum(function(e){return e.enquiries}),A=(w.width($("#div-enquiries-year").width()).height(280).margins({top:5,right:0,bottom:40,left:5}).group(u).ordinalColors([config.colours[3]]).dimension(s).ordering(function(e){return e}).elasticX(!0),$("#reset-chart-enquiries-year").on("click",function(e){return e.preventDefault(),w.filterAll(),dc.redrawAll(),!1}),w.on("renderlet",function(e){e.selectAll("g.axis g.tick text").attr("transform","translate(-10, 10) rotate(315)")}),dc.rowChart("#cht-enquiries-month")),u=i.group().reduceSum(function(e){return e.enquiries}),y=(A.width($("#div-enquiries-month").width()).height(280).label(function(e){return monthsFull[e.key]}).margins({top:5,right:0,bottom:40,left:5}).group(u).ordinalColors([config.colours[3]]).dimension(i).ordering(function(e){return e}).elasticX(!0),A.filterPrinter(function(e){return e.map(function(e){return monthsFull[e]}).join(", ")}),$("#reset-chart-enquiries-month").on("click",function(e){return e.preventDefault(),A.filterAll(),dc.redrawAll(),!1}),A.on("renderlet",function(e){e.selectAll("g.axis g.tick text").attr("transform","translate(-10, 10) rotate(315)")}),dc.barChart("#cht-enquiries-branch")),u=b.group().reduceSum(function(e){return e.enquiries}),x=(y.width($("#div-enquiries-branch").width()).height(280).margins({top:5,right:0,bottom:80,left:60}).group(u).ordinalColors([config.colours[3]]).dimension(b).elasticY(!0).elasticX(!0).xUnits(dc.units.ordinal).brushOn(!1).x(d3.scaleBand()).renderHorizontalGridLines(!0),$("#reset-chart-enquiries-branch").on("click",function(e){return e.preventDefault(),y.filterAll(),dc.redrawAll(),!1}),y.on("renderlet",function(e){e.selectAll("g.x text").attr("transform","translate(-13, 40) rotate(270)")}),dc.rowChart("#cht-pc-year")),u=s.group().reduce(d,c,f),C=(x.width($("#div-pc-year").width()).height(280).margins({top:5,right:0,bottom:40,left:5}).group(u).valueAccessor(function(e){return 0<e.value.count?e.value.total/e.value.count:0}).ordinalColors([config.colours[2]]).dimension(s).ordering(function(e){return e}).elasticX(!0),$("#reset-chart-pc-year").on("click",function(e){return e.preventDefault(),x.filterAll(),dc.redrawAll(),!1}),x.on("renderlet",function(e){e.selectAll("g.axis g.tick text").attr("transform","translate(-10, 10) rotate(315)")}),dc.rowChart("#cht-pc-month")),b=i.group().reduce(d,c,f),k=(C.width($("#div-pc-month").width()).height(280).label(function(e){return monthsFull[e.key]}).margins({top:5,right:0,bottom:40,left:5}).group(b).valueAccessor(function(e){return 0<e.value.count?e.value.total/e.value.count:0}).ordinalColors([config.colours[2]]).dimension(i).ordering(function(e){return e}).elasticX(!0),C.filterPrinter(function(e){return e.map(function(e){return monthsFull[e]}).join(", ")}),$("#reset-chart-pc-month").on("click",function(e){return e.preventDefault(),C.filterAll(),dc.redrawAll(),!1}),C.on("renderlet",function(e){e.selectAll("g.axis g.tick text").attr("transform","translate(-10, 10) rotate(315)")}),dc.barChart("#cht-pc-branch")),u=e.dimension(function(e){return e.Library}),s=u.group().reduce(d,c,f),b=(k.width($("#div-pc-branch").width()).height(280).margins({top:5,right:0,bottom:80,left:60}).group(s).valueAccessor(function(e){return 0<e.value.count?e.value.total/e.value.count:0}).ordinalColors([config.colours[2]]).dimension(u).elasticY(!0).elasticX(!0).xUnits(dc.units.ordinal).brushOn(!1).x(d3.scaleBand()).renderHorizontalGridLines(!0),$("#reset-chart-pc-branch").on("click",function(e){return e.preventDefault(),k.filterAll(),dc.redrawAll(),!1}),k.on("renderlet",function(e){e.selectAll("g.x text").attr("transform","translate(-13, 40) rotate(270)")}),t.bottom(1)[0].date),i=t.top(1)[0].date,D=dc.compositeChart("#cht-usage");D.width($("#div-usage").width()).height(250).dimension(t).margins({top:50,right:60,bottom:30,left:60}).mouseZoomable(!1).shareTitle(!1).shareColors(!1).round(d3.timeMonth.round).elasticX(!0).elasticY(!0).renderHorizontalGridLines(!0).legend(dc.legend().x(0).y(0).horizontal(!0).itemHeight(20).gap(15)).x(d3.scaleTime().domain([b,i])).compose([dc.lineChart(D).group(r,"Issues").interpolate("monotone").colors(config.colours[0]),dc.lineChart(D).group(o,"Visits").interpolate("monotone").title(function(e){var a=e.value.avg||e.value;return isNaN(a)&&(a=0),dateFormat(e.key)+"\n"+numberFormat(a)}).colors(config.colours[1]),dc.lineChart(D).group(n,"Enquiries").interpolate("monotone").title(function(e){var a=e.value.avg||e.value;return isNaN(a)&&(a=0),dateFormat(e.key)+"\n"+numberFormat(a)}).dashStyle([0]).colors(config.colours[2])]).yAxisLabel("Usage count"),$("#reset-chart-usage").on("click",function(e){return e.preventDefault(),D.filterAll(),dc.redrawAll(),!1}),dc.renderAll(),$("#loader").hide();document.styleSheets[0].cssRules[110].style.removeProperty("width");var S=$(window).width();$(window).on("resize",function(){$(window).width()!=S&&(S=$(window).width(),D.width($("#div-usage").width()),l.width($("#div-issues-year").width()),h.width($("#div-issues-branch").width()),m.width($("#div-issues-month").width()),g.width($("#div-visits-year").width()),v.width($("#div-visits-branch").width()),p.width($("#div-visits-month").width()),w.width($("#div-enquiries-year").width()),y.width($("#div-enquiries-branch").width()),A.width($("#div-enquiries-month").width()),x.width($("#div-pc-year").width()),k.width($("#div-pc-branch").width()),C.width($("#div-pc-month").width()),dc.renderAll())})}))});